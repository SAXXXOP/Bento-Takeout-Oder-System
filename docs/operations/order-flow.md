# 業務フロー全体（入力→記録→準備→受け渡し）

## 目的
「何がどこで作られるか」を全員が同じ理解で運用できるようにします。

---

## フロー（基本）
1. お客様が Googleフォーム送信
2. `onFormSubmit` が動く
3. `注文一覧` に記録
   - 予約No発行
   - ステータス（空/無効/★要確認）
   - 理由（REASON）
   - 変更の場合：`SOURCE_NO` に元予約No
4. 店舗が日次準備を実行（手動 or 自動）
   - 予約札（`予約札` タブ）
   - 当日まとめ（`当日まとめ` タブ）
5. 当日：受け渡し（予約札で照合、必要に応じて NOTE/REASON を参照）
6. 事後：★要確認の整理、ログ確認（必要時）

---

## 予約変更（フォームで oldReservationNo が入った場合）
- 変更成立の条件（現行実装）
  - 元予約No が存在する
  - 変更期限（前日20時）内
  - 電話番号が入力され、元予約の電話番号と一致
- 条件を満たさない場合は「変更不成立」として扱い、理由が付与されます（元予約を守る）

---

## 締切（前日20時）について
- 受取日が締切を過ぎた送信は、最終防波堤として検知されます
- 検知されたものは理由に「締切」情報が入り、運用上「無効/要確認」扱いになります

---

## よく使うタブの役割
- 注文一覧：事実の記録（元帳）。ここが壊れると全部止まる
- ★要確認一覧：運用で潰すべき異常の集約（ワークフローで処理）
- 予約札：現場の受け渡し・照合
- 当日まとめ：製造・仕込み用の集計
- メニューマスタ：商品の定義（価格/表示名など）
- ログ：トラブル時の最優先確認先

---

## 付随：運用通知キュー（任意）
- フォーム送信時に「運用通知キュー」へ貯め、1時間ごとにまとめてメール送信できます
- 宛先は `LATE_SUBMISSION_NOTIFY_TO`（締切後送信通知と共用）

---

## 運用の要点
- 「注文一覧」が正しく入っていれば、予約札/当日まとめは作り直せる
- 問題が起きたら、まずログ → 実行履歴 → 原因確定（修正はその後）
