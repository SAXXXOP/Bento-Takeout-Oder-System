# ログの見方（ログタブ / 実行履歴）

## 目的
「簡単な修正で直らない時」は、先にログで原因を確定させてから修正します。

---

## まず見る場所（優先順）
1. スプレッドシートの `ログ` タブ
2. Apps Script エディタ → 「実行」→ 実行履歴（エラー/例外/スタック）
3. （必要なら）対象の `注文一覧` 行、`★要確認一覧` の出力

---

## `ログ` タブの仕様
- `logToSheet(level, message, extra)` で書き込みます
- 1行：`timestamp / level / message / extra`
- `LOG_LEVEL` 以上のレベルのみ記録
  - `DEBUG < INFO < WARN < ERROR`
- `LOG_MAX_ROWS` を超えたら古い行を削除（肥大化防止）

推奨設定：
- `LOG_LEVEL=INFO`
- `LOG_MAX_ROWS=2000`（運用が安定するまで増やしてもOK）

---

## よくあるエラーパターンと当たり
### 1) フォームの質問タイトル変更で拾えない
症状：
- 受け取り日が取得できない / 注文内容が空 等で ★要確認が増える
対処：
- `Config.gs` の `CONFIG.FORM`（部分一致）と、フォームの質問文を合わせる

### 2) 必須タブが無い / 名前が違う
症状：
- `必須タブが見つかりません` 系の例外
対処：
- タブ名をテンプレ通りに戻す（列挿入/削除も注意）

### 3) トリガー未設定 / 重複
症状：
- 送信しても注文一覧に入らない（未設定）
- 二重に入る（重複）
対処：
- `setup/triggers.md` のメニューから再設定（内部で重複削除→作成）

### 4) UI を使う関数をトリガーで実行
症状：
- `Cannot call SpreadsheetApp.getUi() from this context.`
対処：
- トリガー起動先は専用のハンドラ（`dailyPrepTrigger` 等）を使う

---

## 原因確定のためのコツ
- エラーが「再現する手順」を1回書き出す（フォーム送信/日次準備/要確認操作など）
- `ログ` の該当行（message/extra）を見て「どの関数・どの段階」で落ちたか特定する
- 修正は原因が特定できてから（推測で直さない）
