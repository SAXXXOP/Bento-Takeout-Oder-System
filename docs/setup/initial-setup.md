# 初期セットアップ（テンプレコピー〜動作確認）

## 目的
テンプレのスプレッドシートをコピーし、フォーム送信→注文一覧記録までを動作させます。

---

## 前提（このシステムの特徴）
- フォーム送信を起点に `onFormSubmit` が動き、`注文一覧` へ保存します。
- トリガーイベント `e.response` が無い場合でも、スプレッドシートに紐づくフォームURLから「最新回答」を取得して処理できる設計です。
- 必須タブ名（テンプレ同梱前提）：
  - 注文一覧 / メニューマスタ / 当日まとめ / 予約札 / ★要確認一覧 / 休業日設定 / ログ

※ 氏名は **必須ではありません**（未入力でも処理は継続）。ただし受け渡し事故防止のため、可能なら入力推奨です。

---

## 手順

### 1) テンプレのスプレッドシートをコピー
1. テンプレのスプレッドシートを開く
2. 「ファイル」→「コピーを作成」
3. 店舗用の名前（例：`弁当予約管理_店舗名`）で作成

**期待結果**：コピー先にも Apps Script が紐づき、拡張機能→Apps Script で開けます。

---

### 2) フォームとスプレッドシートの紐づけ確認
1. スプレッドシートから「フォームを開く」導線があるか確認
2. ない場合：フォーム側「回答」→「スプレッドシートにリンク」で、このシートに紐づけ直す

**期待結果**：フォームの回答先がこのシートになっています。

---

### 3) 初回実行で権限承認
1. Apps Script を開く
2. 任意の関数を1つ実行（またはスプレッドシート再読み込みで `onOpen` を走らせる）
3. 承認フローを完了

**期待結果**：以後、実行が「権限不足」で止まりません。

---

### 4) Script Properties を設定（必要な分だけ）
- ログ：`LOG_LEVEL`, `LOG_MAX_ROWS`（推奨）
- LINE連携（任意）：`LINE_TOKEN`, `WEBHOOK_KEY`
- バックアップ（任意）：`BACKUP_FOLDER_ID`

詳しくは：`setup/properties.md`

---

### 5) フォーム送信トリガー（必須）
- 関数：`onFormSubmit`
- イベント：フォーム送信時

詳しくは：`setup/triggers.md`

---

### 6) テスト送信（動作確認）
1. フォームからテスト送信（1件）
2. `注文一覧` に1行追加されるか確認
3. `ログ` タブに記録が残るか確認
4. `★要確認一覧` が更新されるか（必要に応じて）

**うまくいかない時**：`troubleshooting/logs.md` を最初に参照してください。
