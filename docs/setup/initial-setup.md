# 初期セットアップ（テンプレコピー〜動作確認）

## 目的
テンプレのスプレッドシートをコピーし、フォーム送信→注文一覧記録までを動作させる。

## 事前に分かっていること（このシステムの前提）
- Googleフォーム送信を起点に `onFormSubmit` が動く
- スプレッドシートに紐づくフォームURLから最新回答を取得できる設計（イベント形式が違っても動きやすい）
- 必須シート名：注文一覧 / 当日まとめ / 予約札 / 顧客名簿 / メニューマスタ / 要確認一覧 / ログ / 設定

---

## 手順

### 1. テンプレのスプレッドシートをコピー
1) テンプレスプレッドシートを開く  
2) 「ファイル」→「コピーを作成」  
3) 店舗用の名前（例：`弁当予約管理_店舗名`）で作成

**期待結果**
- コピー先にも Apps Script が紐づいている（拡張機能→Apps Script で開ける）

---

### 2. スプレッドシートとフォームが紐づいていることを確認
このシステムは `スプレッドシートに紐づくフォームURL` を使うため、紐づけが重要です。

- スプレッドシートから「フォームを開く」導線があるか確認
- ない場合は、フォーム側「回答」→「スプレッドシートにリンク」でこのシートに紐づけ直す

**期待結果**
- スプレッドシート側からフォーム編集へ遷移できる／フォーム側で回答先がこのシートになっている

---

### 3. Script Properties を最低限設定
必須は運用により異なります。まずは「ログ設定」と「（任意機能の）必須値」から。

- バックアップを使う → `BACKUP_FOLDER_ID` が必要
- LINE連携を使う → `LINE_TOKEN` / `WEBHOOK_KEY` が必要

詳しくは：`setup/properties.md`

---

### 4. 初回実行で権限承認
Apps Script を開いて、任意の関数（例：メニュー作成が走る操作）を実行すると承認が出ます。

1) Apps Script を開く  
2) 何か1つ関数を実行（例：メニューが出るようにスプレッドシートを再読み込みでもOK）  
3) 承認フローを完了

**期待結果**
- 実行エラーが「権限不足」で止まらない状態になる

---

### 5. フォーム送信トリガーを作成（必須）
- 関数：`onFormSubmit`
- イベント：フォーム送信時

手順は：`setup/triggers.md`

---

### 6. 動作確認（テスト送信）
1) フォームからテスト送信（1件）  
2) スプレッドシートの `注文一覧` に1行追加されるか確認  
3) `ログ` シートに記録が残るか確認

**期待結果**
- `注文一覧` に行が追加され、予約Noが発行される
- 失敗時は `ログ` と Apps Script の実行履歴にエラーが出る

---

## よくある失敗
- フォームの質問タイトルが `CONFIG.FORM` と一致していない  
- トリガー未設定（`onFormSubmit`）  
- （任意機能をONにしているのに）必須の Script Properties が未設定

トラブル時は：`troubleshooting/logs.md`
